<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>MeteoRe ‚Äì M√©t√©o pr√©cise pour La R√©union</title>
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d47a1">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- html2canvas pour le partage -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'SF Pro Display', 'Segoe UI', system-ui, sans-serif; }
    body {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      color: #0d47a1;
      min-height: 100vh;
      padding: 16px;
      overflow-x: hidden;
    }
    .container { max-width: 100%; margin: 0 auto; }
    .header { text-align: center; margin: 16px 0 24px; }
    .location { font-size: 28px; font-weight: 700; margin-bottom: 4px; color: #0d47a1; }
    .last-update { font-size: 14px; color: #3949ab; opacity: 0.8; }

    .bulletin-du-jour {
      background: #e3f2fd;
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 17px;
      font-weight: 600;
      color: #0d47a1;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      line-height: 1.4;
    }

    .search-box {
      background: white;
      border-radius: 16px;
      padding: 12px 16px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    #search-input {
      width: 100%;
      border: none;
      font-size: 16px;
      outline: none;
      background: transparent;
    }
    #suggestions {
      margin-top: 12px;
      max-height: 150px;
      overflow-y: auto;
    }
    .suggestion {
      padding: 8px 12px;
      background: #e8f5e9;
      border-radius: 12px;
      margin: 6px 0;
      font-weight: 600;
      color: #1b5e20;
      cursor: pointer;
    }
    .suggestion:hover { background: #c8e6c9; }

    .current-weather {
      background: white;
      border-radius: 24px;
      padding: 24px;
      text-align: center;
      margin-bottom: 24px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      position: relative;
      overflow: hidden;
    }
    .current-temp { font-size: 80px; font-weight: 200; margin: 10px 0; }
    .current-condition { font-size: 22px; font-weight: 600; margin-bottom: 12px; }
    .current-details {
      display: flex;
      justify-content: space-around;
      margin-top: 16px;
    }
    .detail-item { text-align: center; font-size: 14px; }
    .detail-value { font-weight: 700; font-size: 16px; }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin: 24px 0 16px;
      color: #0d47a1;
    }
    .forecast-7j {
      display: grid;
      gap: 14px;
      margin-bottom: 24px;
    }
    .day-card {
      background: white;
      border-radius: 18px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .day-info { display: flex; align-items: center; gap: 12px; }
    .day-emoji { font-size: 28px; }
    .day-name { font-weight: 600; font-size: 16px; }
    .day-temp { font-weight: 700; font-size: 18px; }

    .temp-graph {
      background: white;
      border-radius: 18px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .hourly-cards {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding: 8px 0;
    }
    .hourly-cards::-webkit-scrollbar { display: none; }
    .hour-card {
      background: #f5fbff;
      border-radius: 14px;
      padding: 12px 10px;
      min-width: 60px;
      text-align: center;
      border: 1px solid #e3f2fd;
    }
    .hour-time { font-size: 13px; font-weight: 600; color: #3949ab; }
    .hour-emoji { font-size: 22px; margin: 6px 0; }
    .hour-temp { font-size: 15px; font-weight: 700; color: #0d47a1; }

    /* üå™Ô∏è WINDY WIDGET */
    .windy-widget {
      background: white;
      border-radius: 18px;
      padding: 16px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .windy-widget img {
      width: 100%;
      max-width: 600px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: block;
      margin: 0 auto;
    }
    .windy-source {
      font-size: 13px;
      color: #3949ab;
      opacity: 0.85;
      text-align: center;
      margin-top: 10px;
    }
    .windy-link {
      display: inline-block;
      margin-top: 12px;
      color: #1976d2;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
    }

    #meteo-details {
      background: white;
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .detail-section {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e0e0e0;
    }
    .detail-section:last-child { border: none; margin-bottom: 0; padding-bottom: 0; }
    .detail-title {
      font-size: 19px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #0d47a1;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .detail-content {
      font-size: 15px;
      line-height: 1.6;
      color: #37474f;
    }
    .highlight { color: #1976d2; font-weight: 600; }

    .youtube-link {
      display: inline-block;
      background: #ff0000;
      color: white;
      text-decoration: none;
      padding: 10px 18px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      margin: 16px 0;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .share-widget { text-align: center; margin: 24px 0; }
    .share-btn {
      display: inline-block;
      background: #4caf50;
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
    }

    .footer {
      text-align: center;
      font-size: 13px;
      color: #3949ab;
      opacity: 0.8;
      padding: 16px 0;
    }

    @media (max-width: 600px) {
      .current-temp { font-size: 60px; }
      .location { font-size: 24px; }
      .bulletin-du-jour { font-size: 15px; }
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- üîó YOUTUBE -->
    <div style="text-align: center;">
      <a href="https://youtube.com/@meteore974" target="_blank" rel="noopener" class="youtube-link">Retrouve-moi sur YouTube</a>
    </div>

    <!-- üîç RECHERCHE -->
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Rechercher une ville √† La R√©union...">
      <div id="suggestions"></div>
    </div>

    <!-- üå§Ô∏è TITRE -->
    <div class="header">
      <div class="location" id="ville-nom">Chargement...</div>
      <div class="last-update" id="last-update">‚Äî</div>
    </div>

    <!-- üì∞ BULLETIN DU JOUR -->
    <div class="bulletin-du-jour" id="bulletin-du-jour">Chargement du bulletin m√©t√©o...</div>

    <!-- üìä CARTE PRINCIPALE -->
    <div class="current-weather">
      <div class="current-temp" id="current-temp">--¬∞</div>
      <div class="current-condition" id="current-condition">‚Äî</div>
      <div class="current-details">
        <div class="detail-item">
          <div class="detail-value" id="current-humid">‚Äî%</div>
          <div>Humidit√©</div>
        </div>
        <div class="detail-item">
          <div class="detail-value" id="current-wind">‚Äî km/h</div>
          <div>Vent</div>
        </div>
      </div>
    </div>

    <!-- üìà GRAPHIQUE TEMP√âRATURE -->
    <div class="temp-graph">
      <div class="hourly-title">Pr√©vision dans les prochaines heures</div>
      <div class="hourly-cards" id="hourly"></div>
    </div>

    <!-- üìÖ 7 JOURS -->
    <div class="section-title">Pr√©vision 7 jours</div>
    <div class="forecast-7j" id="forecast-7j"></div>

    <!-- üå™Ô∏è WINDY WIDGET -->
    <div class="section-title">üó∫Ô∏è Carte m√©t√©o visuelle</div>
    <div class="windy-widget">
      <img 
        src="https://i.imgur.com/abc123.png" 
        alt="Carte m√©t√©o visuelle ‚Äì Windy"
        onerror="this.src='https://i.imgur.com/irO8yxw.png';"
      />
      <p class="windy-source">Source : Windy.com ‚Ä¢ Mise √† jour manuelle par Nullyxx</p>
      <a href="https://www.windy.com" target="_blank" rel="noopener" class="windy-link">‚û°Ô∏è Voir la carte interactive</a>
    </div>

    <!-- üìö SECTION √âDUCATIVE -->
    <div id="meteo-details">
      <h2 class="detail-title">üìñ Comprendre la m√©t√©o √† La R√©union</h2>
      <div class="detail-section">
        <h3 class="detail-title">üå©Ô∏è Comment se forment les orages ?</h3>
        <div class="detail-content">
          <p>Un orage se forme quand <span class="highlight">l'air chaud et humide</span> monte rapidement. √Ä La R√©union, cela arrive souvent :</p>
          <p>‚Ä¢ L'apr√®s-midi, le soleil chauffe les pentes ‚Üí l'air monte<br>
          ‚Ä¢ En bord de mer, l'humidit√© marine rencontre l'air chaud<br>
          ‚Ä¢ Condensation ‚Üí nuages d'orage (cumulonimbus)</p>
        </div>
      </div>
      <div class="detail-section">
        <h3 class="detail-title">‚õ∞Ô∏è Reliefs et climat</h3>
        <div class="detail-content">
          <p>‚Ä¢ <span class="highlight">√Ä l'est</span> : aliz√©s + reliefs ‚Üí pluies abondantes<br>
          ‚Ä¢ <span class="highlight">√Ä l'ouest</span> (L‚Äô√âtang-Sal√©) : effet de foehn ‚Üí climat sec et ensoleill√©</p>
        </div>
      </div>
    </div>

    <!-- üñºÔ∏è WIDGET PARTAGE -->
    <div class="share-widget">
      <button class="share-btn" id="share-btn">üì∑ Partager cette m√©t√©o</button>
    </div>

    <div class="footer">
      ¬© 2025 MeteoRe ‚Ä¢ M√©t√©o pr√©cise pour La R√©union<br>
      <a href="https://youtube.com/@meteore974" target="_blank" style="color:#ff0000; text-decoration: none;">YouTube</a>
    </div>
  </div>

  <script>
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    function init() {
      const villesReunion = [
        { nom: "Saint-Denis", lat: -20.883, lon: 55.450 },
        { nom: "Saint-Pierre", lat: -21.333, lon: 55.467 },
        { nom: "L'√âtang-Sal√©", lat: -21.150, lon: 55.433 },
        { nom: "Le Tampon", lat: -21.267, lon: 55.517 },
        { nom: "Saint-Beno√Æt", lat: -21.033, lon: 55.717 },
        { nom: "Saint-Andr√©", lat: -20.933, lon: 55.617 },
        { nom: "Le Port", lat: -20.933, lon: 55.283 },
        { nom: "Saint-Louis", lat: -21.21, lon: 55.4 },
        { nom: "Saint-Joseph", lat: -21.383, lon: 55.6 },
        { nom: "La Possession", lat: -20.9, lon: 55.317 },
        { nom: "Cilaos", lat: -21.15, lon: 55.483 },
        { nom: "Salazie", lat: -21.017, lon: 55.533 },
        { nom: "Petite-√éle", lat: -21.35, lon: 55.533 }
      ];

      function getEmoji(code) {
        if (code === 0) return "‚òÄÔ∏è";
        if (code === 1) return "üå§Ô∏è";
        if (code === 2) return "‚õÖ";
        if (code === 3) return "‚òÅÔ∏è";
        if ([45, 48].includes(code)) return "üå´Ô∏è";
        if ([51, 53, 55, 61, 80].includes(code)) return "üå¶Ô∏è";
        if ([63, 65, 81, 82].includes(code)) return "üåßÔ∏è";
        if ([95, 96, 99].includes(code)) return "‚õàÔ∏è";
        return "‚òÅÔ∏è";
      }

      function generateBulletin(temp, code, wind, ville) {
        const hour = new Date().getHours();
        const greeting = hour < 12 ? "Bonjour" : "Bon apr√®s-midi";
        const emoji = getEmoji(code);
        
        if (temp > 29) {
          return `${greeting} de ${ville} ! ${emoji} Il fera tr√®s chaud (${temp}¬∞). Hydratez-vous et √©vitez les efforts. ‚Äî MeteoRe`;
        } else if (code >= 80) {
          return `${greeting} ! ${emoji} Averses ou orages pr√©vus. Restez √† l‚Äôabri en cas de forte pluie. ‚Äî MeteoRe`;
        } else if (wind > 30) {
          return `${greeting} ! üí® Vent fort (${wind} km/h). Attention aux d√©placements en bord de mer. ‚Äî MeteoRe`;
        } else {
          return `${greeting} de ${ville} ! ${emoji} Belle journ√©e en perspective. ‚Äî MeteoRe`;
        }
      }

      async function fetchWeather(lat, lon, nomVille) {
        try {
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weathercode,relative_humidity_2m,wind_speed_10m&hourly=temperature_2m,weathercode&daily=temperature_2m_max,temperature_2m_min,weathercode&forecast_days=8&timezone=Indian/Reunion`;
          const res = await fetch(url);
          const data = await res.json();

          const current = data.current;
          const tempNow = Math.round(current.temperature_2m);
          const windNow = Math.round(current.wind_speed_10m * 3.6);

          document.getElementById('ville-nom').textContent = nomVille;
          document.getElementById('last-update').textContent = `Donn√©es en temps r√©el`;
          document.getElementById('current-temp').textContent = `${tempNow}¬∞`;
          document.getElementById('current-condition').textContent = getConditionText(current.weathercode);
          document.getElementById('current-humid').textContent = `${Math.round(current.relative_humidity_2m)}%`;
          document.getElementById('current-wind').textContent = `${windNow} km/h`;

          // Bulletin personnalis√©
          const bulletin = generateBulletin(tempNow, current.weathercode, windNow, nomVille);
          document.getElementById('bulletin-du-jour').textContent = bulletin;

          renderHourly(data.hourly, data.hourly.time);
          renderForecast7j(data.daily, data.daily.time);

        } catch (e) {
          console.error(e);
          document.getElementById('ville-nom').textContent = nomVille;
          document.getElementById('current-temp').textContent = `--¬∞`;
          document.getElementById('current-condition').textContent = `Donn√©es non disponibles`;
          document.getElementById('current-humid').textContent = `‚Äî%`;
          document.getElementById('current-wind').textContent = `‚Äî km/h`;
          document.getElementById('bulletin-du-jour').textContent = `Impossible de charger le bulletin m√©t√©o.`;
        }
      }

      function getConditionText(code) {
        if (code === 0) return "Ciel d√©gag√©";
        if ([1,2].includes(code)) return "Ciel partiellement nuageux";
        if (code === 3) return "Ciel couvert";
        if ([51,53,55,61].includes(code)) return "Pluie faible";
        if ([63,65].includes(code)) return "Pluie mod√©r√©e";
        if ([80,81,82].includes(code)) return "Averses";
        if ([95,96,99].includes(code)) return "Orages";
        return "Nuageux";
      }

      function renderHourly(hourly, times) {
        const container = document.getElementById('hourly');
        container.innerHTML = '';
        const now = new Date();
        let count = 0;
        for (let i = 0; i < times.length && count < 12; i++) {
          const time = new Date(times[i]);
          if (time < now) continue;
          const hourStr = time.getHours().toString().padStart(2, '0') + 'h';
          const temp = Math.round(hourly.temperature_2m[i]);
          const emoji = getEmoji(hourly.weathercode[i]);
          const card = document.createElement('div');
          card.className = 'hour-card';
          card.innerHTML = `
            <div class="hour-time">${hourStr}</div>
            <div class="hour-emoji">${emoji}</div>
            <div class="hour-temp">${temp}¬∞</div>
          `;
          container.appendChild(card);
          count++;
        }
      }

      function renderForecast7j(daily, times) {
        const container = document.getElementById('forecast-7j');
        container.innerHTML = '';
        const days = ["Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam"];
        for (let i = 0; i < 7; i++) {
          const date = new Date(times[i]);
          const dayName = i === 0 ? "Aujourd'hui" : days[date.getDay()];
          const min = Math.round(daily.temperature_2m_min[i]);
          const max = Math.round(daily.temperature_2m_max[i]);
          const emoji = getEmoji(daily.weathercode[i]);
          const card = document.createElement('div');
          card.className = 'day-card';
          card.innerHTML = `
            <div class="day-info">
              <div class="day-emoji">${emoji}</div>
              <div class="day-name">${dayName}</div>
            </div>
            <div class="day-temp">${min}¬∞ / ${max}¬∞</div>
          `;
          container.appendChild(card);
        }
      }

      const input = document.getElementById('search-input');
      const suggestions = document.getElementById('suggestions');

      input.addEventListener('focus', () => showAllVilles());
      input.addEventListener('input', () => {
        const term = input.value.toLowerCase().trim();
        if (term === '') showAllVilles();
        else {
          const matches = villesReunion.filter(v => v.nom.toLowerCase().includes(term)).slice(0, 8);
          showSuggestions(matches);
        }
      });

      function showAllVilles() { showSuggestions(villesReunion); }
      function showSuggestions(list) {
        suggestions.innerHTML = '';
        list.forEach(v => {
          const el = document.createElement('div');
          el.className = 'suggestion';
          el.textContent = v.nom;
          el.onclick = () => {
            input.value = v.nom;
            suggestions.innerHTML = '';
            fetchWeather(v.lat, v.lon, v.nom);
            input.blur();
          };
          suggestions.appendChild(el);
        });
      }

      document.getElementById('share-btn').addEventListener('click', () => {
        html2canvas(document.querySelector('.current-weather')).then(canvas => {
          const link = document.createElement('a');
          link.download = 'meteo-reunion.png';
          link.href = canvas.toDataURL();
          link.click();
        });
      });

      fetchWeather(-21.150, 55.433, "L'√âtang-Sal√©");
    }
  </script>

</body>
</html>
