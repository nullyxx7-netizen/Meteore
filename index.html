<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>MeteoRe ‚Äì M√©t√©o pr√©cise pour La R√©union</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d47a1">
<link rel="apple-touch-icon" href="icon-194.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
/* ===== WATERMARK DISCRET MAIS √âL√âGANT ===== */
body::after {
	content: "MeteoRe";
	position: fixed;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%) rotate(-30deg);
	font-size: 110px;
	font-weight: 800;
	color: rgba(2, 136, 209, 0.02);
	pointer-events: none;
	z-index: -2;
	white-space: nowrap;
	font-family: 'Inter', sans-serif;
	letter-spacing: -2px;
}

/* ===== EFFETS M√âT√âO CONTEXTUELS (ORAGE ADOUCCI) ===== */
body.sun-glow {
	background: linear-gradient(135deg, #e3f2fd, #bbdefb);
	--text: #006064;
}
body.cloudy-dim {
	background: linear-gradient(135deg, #e0e0e0, #b0bec5);
	filter: brightness(0.94);
	--text: #37474f;
}
body.rainy-dim {
	background: linear-gradient(135deg, #b0bec5, #90a4ae);
	filter: brightness(0.88);
	--text: #455a64;
}
body.stormy-dim {
	background: linear-gradient(135deg, #607d8b, #455a64);
	filter: brightness(0.85); /* ‚úÖ all√©g√© */
	--text: #e0e0e0;
}

/* ===== ANIMATIONS M√âT√âO (sans raindrop) ===== */
.storm-flash {
	position: fixed;
	top: 0; left: 0; width: 100%; height: 100%;
	background: white;
	opacity: 0;
	pointer-events: none;
	z-index: 2000;
}
.weather-animation {
	position: fixed;
	top: 0; left: 0; width: 100%; height: 100%;
	pointer-events: none;
	z-index: -1;
	opacity: 0;
	display: none;
}
#anim-sun {
	top: -120px;
	right: -120px;
	width: 320px;
	height: 320px;
	background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, transparent 70%);
	border-radius: 50%;
	animation: floatSun 50s infinite linear;
	filter: blur(6px);
	opacity: 0.85;
}
#anim-cloud {
	top: 15%;
	left: -160px;
	width: 220px;
	height: 90px;
	background: radial-gradient(ellipse, rgba(255,255,255,0.45) 0%, transparent 80%);
	border-radius: 50%;
	animation: floatCloud 70s infinite ease-in-out;
}
@keyframes floatSun { to { transform: translateX(200px) rotate(360deg); } }
@keyframes floatCloud { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(200px); } }

/* ===== GLOBAL ===== */
:root {
	--bg: linear-gradient(135deg, #f0f9ff, #d0f0ff);
	--card-bg: rgba(255, 255, 255, 0.92);
	--text: #006064;
	--accent: #0288d1;
	--shadow: 0 8px 24px rgba(2, 136, 209, 0.12);
	--border: rgba(2, 136, 209, 0.15);
}
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	font-family: 'Inter', system-ui, -apple-system, sans-serif;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}
body {
	background: var(--bg);
	color: var(--text);
	min-height: 100vh;
	padding: 0;
	overflow-x: hidden;
	transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
}
#intro {
	position: fixed;
	top: 0; left: 0; width: 100%; height: 100%;
	background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	z-index: 9999;
	opacity: 1;
	transition: opacity 0.7s ease-out;
}
#intro.hidden {
	opacity: 0;
	pointer-events: none;
}
#intro-logo {
	width: 120px;
	height: 120px;
	border-radius: 24px;
	margin-bottom: 20px;
	box-shadow: 0 10px 30px rgba(0,0,0,0.15);
	animation: pulse 1.5s ease-in-out;
}
@keyframes pulse {
	0% { transform: scale(0.9); opacity: 0; }
	70% { transform: scale(1.05); }
	100% { transform: scale(1); opacity: 1; }
}
#intro-text {
	font-size: 34px;
	font-weight: 800;
	color: var(--accent);
	letter-spacing: 1.2px;
	text-shadow: 0 2px 6px rgba(0,0,0,0.08);
}
#loading-indicator {
	color: var(--accent);
	font-size: 16px;
	margin-top: 12px;
	opacity: 0.8;
	display: none;
}
#vigilance-static {
	display: inline-block;
	background: #4CAF50;
	color: #000;
	font-weight: 700;
	font-size: 12px;
	font-family: 'Inter', sans-serif;
	letter-spacing: 0.3px;
	padding: 4px 12px;
	border-radius: 20px;
	margin: 12px 16px;
	box-shadow: 0 3px 8px rgba(0,0,0,0.1);
	z-index: 2000;
	backdrop-filter: blur(4px);
}
.top-bar {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 18px 20px;
	background: rgba(255, 255, 255, 0.8);
	backdrop-filter: blur(14px);
	-webkit-backdrop-filter: blur(14px);
	border-bottom: 1px solid var(--border);
	z-index: 100;
	box-shadow: 0 2px 10px rgba(0,0,0,0.04);
}
.logo-with-version {
	display: flex;
	flex-direction: column;
	align-items: flex-start;
}
.logo {
	font-weight: 800;
	font-size: 23px;
	color: var(--accent);
	letter-spacing: -0.5px;
}
.version {
	font-size: 10px;
	opacity: 0.8;
	margin-top: -2px;
	font-weight: 600;
}
.action-buttons {
	display: flex;
	gap: 10px;
	align-items: center;
}
.btn {
	padding: 7px 12px;
	border: none;
	border-radius: 12px;
	font-weight: 600;
	font-size: 13px;
	cursor: pointer;
	transition: all 0.25s ease;
}
.youtube-btn {
	background: #ff0000;
	color: white;
	box-shadow: 0 4px 10px rgba(255,0,0,0.2);
}
.youtube-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 14px rgba(255,0,0,0.25);
	background: #e00000;
}
#speak-btn {
	background: #5E35B1;
	color: white;
	box-shadow: 0 4px 10px rgba(94,53,177,0.2);
}
#speak-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 14px rgba(94,53,177,0.25);
	background: #4a2a9d;
}
#geoloc-btn {
	background: #00C853;
	color: white;
	box-shadow: 0 4px 10px rgba(0,200,83,0.2);
}
#geoloc-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 14px rgba(0,200,83,0.25);
	background: #00a847;
}
.container {
	max-width: 900px;
	margin: 0 auto;
	padding: 0 16px 100px;
}
.current-weather {
	background: var(--card-bg);
	backdrop-filter: blur(14px);
	-webkit-backdrop-filter: blur(14px);
	border-radius: 26px;
	padding: 32px 24px;
	text-align: center;
	margin: 28px 0 32px;
	box-shadow: var(--shadow);
	border: 1px solid var(--border);
	transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.current-weather:hover {
	transform: translateY(-3px);
	box-shadow: 0 12px 30px rgba(2, 136, 209, 0.18);
}
.location {
	font-size: 24px;
	font-weight: 800;
	margin-bottom: 12px;
	color: #004d40;
}
.current-temp {
	font-size: 88px;
	font-weight: 200;
	margin: 10px 0;
	background: linear-gradient(90deg, #0288d1, #00bcd4);
	-webkit-background-clip: text;
	-webkit-text-fill-color: transparent;
	background-clip: text;
}
.current-feels-like {
	font-size: 20px;
	opacity: 0.85;
	margin-bottom: 8px;
	color: #0288d1;
}
.current-condition {
	font-size: 22px;
	font-weight: 700;
	margin: 12px 0;
	color: #004d40;
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 10px;
}
.current-insight {
	font-size: 16px;
	font-weight: 600;
	margin-top: 16px;
	opacity: 0.95;
	color: var(--accent);
	line-height: 1.4;
	padding: 0 10px;
}
.details-pro {
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	gap: 16px;
	margin-top: 24px;
}
.detail-card {
	background: rgba(224, 247, 250, 0.6);
	border-radius: 18px;
	padding: 16px;
	text-align: center;
	transition: all 0.25s ease;
	border: 1px solid rgba(2, 136, 209, 0.1);
}
.detail-card:hover {
	transform: translateY(-4px);
	background: rgba(178, 235, 242, 0.9);
	box-shadow: 0 6px 14px rgba(0,0,0,0.08);
}
.detail-value {
	font-weight: 800;
	font-size: 19px;
	color: #006064;
	margin-bottom: 4px;
}
.detail-label {
	font-size: 13px;
	opacity: 0.85;
	font-weight: 500;
}
.section-title {
	font-size: 21px;
	font-weight: 700;
	margin: 32px 0 20px;
	color: #004d40;
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 0 4px;
}
.hourly-cards {
	display: flex;
	gap: 16px;
	overflow-x: auto;
	padding: 8px 0 16px;
	-ms-overflow-style: none;
	scrollbar-width: none;
}
.hourly-cards::-webkit-scrollbar {
	display: none;
}
.hour-card {
	background: var(--card-bg);
	border-radius: 20px;
	padding: 18px 12px;
	min-width: 84px;
	text-align: center;
	border: 1px solid var(--border);
	transition: all 0.25s cubic-bezier(0.23, 1, 0.32, 1);
	box-shadow: 0 4px 12px rgba(0,0,0,0.05);
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
}
.hour-card:hover {
	transform: translateY(-6px);
	box-shadow: 0 8px 22px rgba(0,0,0,0.12);
	z-index: 10;
}
.hour-card img {
	margin: 6px 0;
	width: 30px;
	height: 30px;
	filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
}
.forecast-7j {
	display: grid;
	gap: 18px;
	margin-bottom: 32px;
}
.day-card {
	background: var(--card-bg);
	border-radius: 22px;
	padding: 20px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	border: 1px solid var(--border);
	transition: all 0.25s ease;
	box-shadow: 0 4px 12px rgba(0,0,0,0.04);
}
.day-card:hover {
	transform: translateX(6px);
	box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}
.day-card img {
	width: 32px;
	height: 32px;
	filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
}
.cyclone-widget {
	background: var(--card-bg);
	border-radius: 22px;
	padding: 22px;
	margin-bottom: 32px;
	box-shadow: var(--shadow);
	border: 1px solid var(--border);
	text-align: center;
}
#cyclone-image {
	width: 100%;
	max-width: 600px;
	border-radius: 16px;
	display: block;
	margin: 0 auto;
	object-fit: cover;
	box-shadow: 0 6px 18px rgba(0,0,0,0.1);
}
.footer {
	text-align: center;
	font-size: 13px;
	opacity: 0.8;
	padding: 20px 0 10px;
	color: var(--text);
}
.footer img {
	width: 22px;
	height: 22px;
	opacity: 0.7;
	margin-top: 8px;
	filter: grayscale(1) opacity(0.6);
}
.search-bottom {
	position: fixed;
	bottom: 24px;
	left: 50%;
	transform: translateX(-50%);
	width: 92%;
	max-width: 520px;
	background: rgba(255, 255, 255, 0.92);
	border-radius: 18px;
	padding: 14px 18px;
	box-shadow: 0 8px 28px rgba(0, 120, 150, 0.25);
	border: 1px solid var(--border);
	z-index: 900;
	backdrop-filter: blur(12px);
	-webkit-backdrop-filter: blur(12px);
}
#search-input-bottom {
	width: 100%;
	border: none;
	font-size: 16px;
	outline: none;
	background: transparent;
	color: var(--text);
	text-align: center;
	font-weight: 600;
	cursor: pointer;
	padding: 4px 0;
}
.suggestions-dropdown {
	position: absolute;
	bottom: 100%;
	left: 0;
	width: 100%;
	background: white;
	border: 1px solid var(--border);
	border-radius: 16px;
	max-height: 240px;
	overflow-y: auto;
	z-index: 9999;
	box-shadow: 0 10px 28px rgba(0,0,0,0.18);
	display: none;
	margin-bottom: 12px;
	backdrop-filter: blur(10px);
	-webkit-backdrop-filter: blur(10px);
}
.suggestion-item {
	padding: 14px 20px;
	cursor: pointer;
	border-bottom: 1px solid #f0f8ff;
	font-weight: 600;
	transition: all 0.2s ease;
}
.suggestion-item:last-child {
	border-bottom: none;
	border-radius: 0 0 16px 16px;
}
.suggestion-item:hover {
	background: #e3f2fd;
	color: var(--accent);
	transform: translateX(4px);
}
#click-sound {
	display: none;
}
</style>
</head>
<body>
<audio id="click-sound">
<source src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZAAAAAAAAAAAAAP/R0lG/AAAAwAAAAAABAAACwAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV..." type="audio/mpeg">
</audio>

<!-- ‚úÖ Plus d‚Äôanimation de pluie -->
<div class="storm-flash" id="lightning-flash"></div>
<div class="weather-animation" id="anim-sun"></div>
<div class="weather-animation" id="anim-cloud"></div>

<div id="intro">
	<img id="intro-logo" src="https://i.imgur.com/KsA0dbG.jpeg" alt="Logo MeteoRe">
	<div id="intro-text">MeteoRe</div>
	<div id="loading-indicator">Chargement de la m√©t√©o‚Ä¶</div>
</div>

<div id="vigilance-static">Vigilance ‚Äì Pas de vigilance</div>

<div class="top-bar">
	<div class="logo-with-version">
		<div class="logo">MeteoRe</div>
		<div class="version">v1.21.3</div>
	</div>
	<div class="action-buttons">
		<button class="btn youtube-btn">‚ñ∂Ô∏è YouTube</button>
		<button class="btn" id="speak-btn">üîà √âcouter</button>
		<button class="btn" id="geoloc-btn">üìç Ma position</button>
	</div>
</div>

<div class="container">
	<div class="current-weather">
		<div class="location" id="ville-nom">Chargement...</div>
		<div class="current-temp" id="current-temp">--¬∞</div>
		<div class="current-feels-like" id="current-feels-like"></div>
		<div class="current-condition" id="current-condition">‚Äî</div>
		<div class="current-insight" id="current-insight"></div>
		
		<div class="details-pro">
			<div class="detail-card">
				<div class="detail-value" id="wind">‚Äî km/h ‚Äî</div>
				<div class="detail-label">Vent</div>
				<div style="margin-top:6px; height:24px; display:flex; justify-content:center;">
					<svg id="wind-compass" width="24" height="24" viewBox="0 0 24 24">
						<circle cx="12" cy="12" r="10" fill="none" stroke="#0288d1" stroke-width="1"/>
						<line x1="12" y1="12" x2="12" y2="4" stroke="#0288d1" stroke-width="2"/>
					</svg>
				</div>
			</div>
			<div class="detail-card">
				<div class="detail-value" id="swell">‚Äî m</div>
				<div class="detail-label" id="swell-label">Houle</div>
				<div style="font-size:11px; opacity:0.8; margin-top:4px;" id="swell-period"></div>
			</div>
			<div class="detail-card">
				<div class="detail-value" id="humidity">‚Äî%</div>
				<div class="detail-label">Humidit√©</div>
				<div style="font-size:11px; opacity:0.8; margin-top:4px;">UV: <span id="uv">‚Äî</span> | Pression: <span id="pressure">‚Äî hPa</span></div>
			</div>
		</div>
	</div>

	<div class="section-title">
		<span>Pr√©vision sur 2 jours</span>
		<button id="share-btn" style="background:#0288d1;color:white;border:none;border-radius:8px;padding:6px 12px;font-size:13px;font-weight:600;cursor:pointer;box-shadow:0 2px 6px rgba(2,136,209,0.3);">
			üì∏ Partager
		</button>
	</div>
	<div class="hourly-cards" id="hourly"></div>

	<div class="section-title">Pr√©vision 7 jours</div>
	<div class="forecast-7j" id="forecast-7j"></div>

	<div class="section-title">Activit√© cyclonique ‚Äì Mise √† jour quotidienne</div>
	<div class="cyclone-widget">
		<img id="cyclone-image"
			src="https://via.placeholder.com/600x300/e0f7fa/006064?text=Image+cyclonique+√†+venir"
			alt="Carte cyclonique MeteoRe">
		<p style="font-size:13px; opacity:0.85; margin-top:12px;">Mise √† jour quotidienne par MeteoRe</p>
	</div>

	<div class="footer">
		¬© 2025 MeteoRe ‚Ä¢ M√©t√©o pr√©cise pour La R√©union<br>
		<img src="https://i.imgur.com/KsA0dbG.jpeg" alt="MeteoRe" style="width:22px; height:22px; opacity:0.7; margin-top:8px;">
	</div>
</div>

<div class="search-bottom">
	<input type="text" id="search-input-bottom" placeholder="Choisissez une ville..." readonly>
	<div id="suggestions-dropdown" class="suggestions-dropdown"></div>
</div>

<script>
// ==== DONN√âES MANUELLES POUR LES 3 VILLES ====
const villesManuelles = [
	{ nom: "L'√âtang-Sal√©" },
	{ nom: "Saint-Pierre" },
	{ nom: "Saint-Denis" }
];

// üìù Tu modifies ces objets quand tu veux !
const previsionsManuelles = {
	"L'√âtang-Sal√©": {
		"00h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"01h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"02h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"03h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"04h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"05h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"06h": { label: "Peu nuageux", icon: "https://i.imgur.com/1gHBkKj.png" },
		"07h": { label: "Peu nuageux", icon: "https://i.imgur.com/1gHBkKj.png" },
		"08h": { label: "Peu nuageux", icon: "https://i.imgur.com/1gHBkKj.png" },
		"09h": { label: "√âclaircies", icon: "https://i.imgur.com/1gHBkKj.png" },
		"10h": { label: "√âclaircies", icon: "https://i.imgur.com/1gHBkKj.png" },
		"11h": { label: "√âclaircies", icon: "https://i.imgur.com/1gHBkKj.png" },
		"12h": { label: "√âclaircies", icon: "https://i.imgur.com/1gHBkKj.png" },
		"13h": { label: "√âclaircies", icon: "https://i.imgur.com/1gHBkKj.png" },
		"14h": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"15h": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"16h": { label: "Averses", icon: "https://i.imgur.com/UTtGtvk.png" },
		"17h": { label: "Averses", icon: "https://i.imgur.com/UTtGtvk.png" },
		"18h": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"19h": { label: "Peu nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"20h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"21h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"22h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"23h": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"00h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"01h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"02h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"03h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"04h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"05h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"06h_j1": { label: "Ensoleill√©", icon: "https://i.imgur.com/9mtLzHK.png" },
		"07h_j1": { label: "Ensoleill√©", icon: "https://i.imgur.com/9mtLzHK.png" },
		"08h_j1": { label: "Ensoleill√©", icon: "https://i.imgur.com/9mtLzHK.png" },
		"09h_j1": { label: "Ensoleill√©", icon: "https://i.imgur.com/9mtLzHK.png" },
		"10h_j1": { label: "Ensoleill√©", icon: "https://i.imgur.com/9mtLzHK.png" },
		"11h_j1": { label: "Ensoleill√©", icon: "https://i.imgur.com/9mtLzHK.png" },
		"12h_j1": { label: "√âclaircies", icon: "https://i.imgur.com/8EIg3fq.png" },
		"13h_j1": { label: "√âclaircies", icon: "https://i.imgur.com/8EIg3fq.png" },
		"14h_j1": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"15h_j1": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"16h_j1": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"17h_j1": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"18h_j1": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"19h_j1": { label: "Tr√®s nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"20h_j1": { label: "Peu nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"21h_j1": { label: "Peu nuageux", icon: "https://i.imgur.com/8EIg3fq.png" },
		"22h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" },
		"23h_j1": { label: "Nuit clair", icon: "https://i.imgur.com/9mtLzHK.png" }
	},
	"Saint-Pierre": {},
	"Saint-Denis": {}
};

// Si tu n‚Äôas pas encore rempli Saint-Pierre et Saint-Denis, on duplique L‚Äô√âtang-Sal√©
if (Object.keys(previsionsManuelles["Saint-Pierre"]).length === 0) {
	previsionsManuelles["Saint-Pierre"] = { ...previsionsManuelles["L'√âtang-Sal√©"] };
}
if (Object.keys(previsionsManuelles["Saint-Denis"]).length === 0) {
	previsionsManuelles["Saint-Denis"] = { ...previsionsManuelles["L'√âtang-Sal√©"] };
}

// ==== UTILS ====
const moisNoms = ["jan", "f√©v", "mar", "avr", "mai", "juin", "juil", "ao√ªt", "sept", "oct", "nov", "d√©c"];

function formatDateForHourly(date) {
	const jour = date.getDate();
	const mois = moisNoms[date.getMonth()];
	return `${jour} ${mois}`;
}

function flashLightning() {
	const flash = document.getElementById('lightning-flash');
	flash.style.opacity = '0.3';
	setTimeout(() => flash.style.opacity = '0', 100);
	setTimeout(() => {
		flash.style.opacity = '0.2';
		setTimeout(() => flash.style.opacity = '0', 80);
	}, 300 + Math.random() * 500);
}

function clearWeatherEffects() {
	document.body.className = '';
	['anim-sun', 'anim-cloud'].forEach(id => {
		const el = document.getElementById(id);
		if (el) el.style.display = 'none';
	});
	if (window.lightningInterval) clearInterval(window.lightningInterval);
}

function updateWeatherAnimation(condition) {
	clearWeatherEffects();
	const c = condition.toLowerCase();
	if (c.includes('ensoleill√©') || c.includes('clair') || c.includes('√©claircies') || c.includes('soleil')) {
		document.body.classList.add('sun-glow');
		document.getElementById('anim-sun').style.display = 'block';
	}
	else if (c.includes('nuageux') || c.includes('couvert') || c.includes('brouillard') || c.includes('voil√©')) {
		document.body.classList.add('cloudy-dim');
		document.getElementById('anim-cloud').style.display = 'block';
	}
	else if (c.includes('pluie') || c.includes('averses') || c.includes('faibles')) {
		document.body.classList.add('rainy-dim');
		document.getElementById('anim-cloud').style.display = 'block';
	}
	else if (c.includes('orage') || c.includes('orages') || c.includes('violents') || c.includes('fortes')) {
		document.body.classList.add('stormy-dim');
		document.getElementById('anim-cloud').style.display = 'block';
		window.lightningInterval = setInterval(flashLightning, 2000 + Math.random() * 3000);
	}
}

function generateInsight(condition) {
	const insight = document.getElementById('current-insight');
	const c = condition.toLowerCase();
	if (c.includes('orage')) {
		insight.textContent = "‚ö° √âvitez les zones expos√©es et les randonn√©es en altitude.";
	} else if (c.includes('pluie') || c.includes('averses')) {
		insight.textContent = "üíß Pr√©voyez un imperm√©able si vous sortez.";
	} else if (c.includes('ensoleill√©') || c.includes('clair') || c.includes('√©claircies')) {
		insight.textContent = "üå§ Id√©al pour une randonn√©e ou un pique-nique !";
	} else if (c.includes('nuageux') || c.includes('couvert')) {
		insight.textContent = "‚òÅÔ∏è Ambiance calme ‚Äî bon moment pour d√©couvrir les cirques.";
	} else {
		insight.textContent = "üå¶ Une journ√©e typique √† La R√©union.";
	}
}

// ==== RENDU MANUEL ====
function renderManualWeather(villeNom) {
	const data = previsionsManuelles[villeNom];
	if (!data) return;

	const now = new Date();
	const utcNow = new Date(now.getTime() + now.getTimezoneOffset() * 60000);
	const reunionTime = new Date(utcNow.getTime() + 4 * 3600000); // UTC+4

	let startHour = reunionTime.getHours();
	let startMinute = reunionTime.getMinutes();
	let offset = (startMinute >= 0) ? 1 : 0; // on commence √† l‚Äôheure suivante
	let currentHourKey = ((startHour + offset) % 24).toString().padStart(2, '0') + 'h';

	// Liste ordonn√©e des cl√©s disponibles
	const orderedKeys = Object.keys(data).sort((a, b) => {
		const hourA = parseInt(a.replace(/_j1$/, ''), 10);
		const hourB = parseInt(b.replace(/_j1$/, ''), 10);
		const dayA = a.includes('_j1') ? 1 : 0;
		const dayB = b.includes('_j1') ? 1 : 0;
		if (dayA !== dayB) return dayA - dayB;
		return hourA - hourB;
	});

	let startIndex = orderedKeys.indexOf(currentHourKey);
	if (startIndex === -1) {
		// Si on est apr√®s 23h, on commence √† 00h_j1
		startIndex = orderedKeys.findIndex(k => k.startsWith('00h_j1'));
	}
	if (startIndex === -1) startIndex = 0;

	const slice = orderedKeys.slice(startIndex, startIndex + 48);
	const hourlyContainer = document.getElementById('hourly');
	hourlyContainer.innerHTML = '';

	slice.forEach((key, idx) => {
		const isJ1 = key.includes('_j1');
		const hourNum = parseInt(key.replace('h', '').replace('_j1', ''), 10);
		const time = new Date(reunionTime);
		if (isJ1) time.setDate(time.getDate() + 1);
		time.setHours(hourNum, 0, 0, 0);

		const dayStr = formatDateForHourly(time);
		const todayStr = formatDateForHourly(reunionTime);
		const showDate = isJ1 || dayStr !== todayStr;

		const entry = data[key];
		const card = document.createElement('div');
		card.className = 'hour-card';
		card.innerHTML = `
			<div style="font-size:13px; font-weight:600;">${hourNum}h</div>
			<img src="${entry.icon}" alt="${entry.label}" style="width:30px;height:30px;margin:6px 0;">
			<div style="font-weight:800;margin-top:4px;">${entry.label}</div>
			${showDate ? `<div style="font-size:11px; margin-top:6px; color:#006064;">${dayStr}</div>` : ''}
		`;
		hourlyContainer.appendChild(card);
	});

	// Affichage actuel (on prend l‚Äôheure actuelle sans offset)
	const currentKey = reunionTime.getHours().toString().padStart(2, '0') + 'h';
	const currentEntry = data[currentKey] || Object.values(data)[0];
	document.getElementById('ville-nom').textContent = villeNom;
	document.getElementById('current-temp').textContent = "‚Äì¬∞";
	document.getElementById('current-feels-like').textContent = "";
	document.getElementById('current-condition').textContent = currentEntry.label;
	document.getElementById('humidity').textContent = "‚Äì%";
	document.getElementById('wind').textContent = "‚Äì km/h ‚Äì";
	document.getElementById('uv').textContent = "‚Äì";
	document.getElementById('pressure').textContent = "‚Äì hPa";

	generateInsight(currentEntry.label);
	updateWeatherAnimation(currentEntry.label);

	// 7 jours simul√©s
	const daysContainer = document.getElementById('forecast-7j');
	daysContainer.innerHTML = '';
	const days = ["Aujourd'hui", "Demain", "J+2", "J+3", "J+4", "J+5", "J+6"];
	for (let i = 0; i < 7; i++) {
		const card = document.createElement('div');
		card.className = 'day-card';
		card.innerHTML = `
			<div style="display:flex;align-items:center;gap:12px;">
				<img src="${Object.values(data)[i*4]?.icon || 'https://i.imgur.com/8EIg3fq.png'}" alt="Jour">
				<div style="font-weight:600;">${days[i]}</div>
			</div>
			<div style="text-align:right;">
				<div style="font-weight:800;">‚Äì¬∞ / ‚Äì¬∞</div>
				<div style="font-size:12px; opacity:0.85;">${Object.values(data)[i*4]?.label || 'Donn√©e manuelle'}</div>
			</div>
		`;
		daysContainer.appendChild(card);
	}
}

// ==== UI ====
function playClickSound() {
	const sound = document.getElementById('click-sound');
	sound.currentTime = 0;
	sound.play().catch(() => {});
}

const searchInput = document.getElementById('search-input-bottom');
const suggestionsDropdown = document.getElementById('suggestions-dropdown');

function showSuggestions() {
	suggestionsDropdown.innerHTML = '';
	suggestionsDropdown.style.display = 'block';
	villesManuelles.forEach(v => {
		const el = document.createElement('div');
		el.className = 'suggestion-item';
		el.textContent = v.nom;
		el.onclick = () => {
			playClickSound();
			searchInput.value = v.nom;
			suggestionsDropdown.style.display = 'none';
			renderManualWeather(v.nom);
		};
		suggestionsDropdown.appendChild(el);
	});
}

searchInput.addEventListener('click', () => {
	playClickSound();
	showSuggestions();
});

document.addEventListener('click', (e) => {
	if (!searchInput.contains(e.target) && !suggestionsDropdown.contains(e.target)) {
		suggestionsDropdown.style.display = 'none';
	}
});

document.querySelectorAll('.btn, .hour-card, .day-card, .detail-card').forEach(el => {
	el.addEventListener('click', playClickSound);
});

document.querySelector('.youtube-btn').addEventListener('click', () => {
	window.open('https://youtube.com/@meteore974', '_blank');
});

document.getElementById('speak-btn').addEventListener('click', () => {
	playClickSound();
	const msg = new SpeechSynthesisUtterance();
	msg.lang = 'fr-FR';
	msg.text = `M√©t√©o √† ${document.getElementById('ville-nom').textContent}. ${document.getElementById('current-condition').textContent}.`;
	speechSynthesis.speak(msg);
});

document.getElementById('geoloc-btn').addEventListener('click', () => {
	playClickSound();
	alert("La g√©olocalisation est d√©sactiv√©e ‚Äî donn√©es manuelles uniquement.");
});

document.getElementById('share-btn').addEventListener('click', async () => {
	const element = document.querySelector('.container');
	const canvas = await html2canvas(element, { backgroundColor: null, scale: 1.5 });
	const ctx = canvas.getContext('2d');
	ctx.globalAlpha = 0.04;
	ctx.font = 'bold 90px Inter';
	ctx.fillStyle = '#0288d1';
	ctx.translate(canvas.width / 2, canvas.height / 2);
	ctx.rotate(-Math.PI / 6);
	ctx.fillText('MeteoRe', -200, 0);
	ctx.setTransform(1, 0, 0, 1, 0, 0);
	const link = document.createElement('a');
	link.download = `meteoRe-${new Date().toISOString().slice(0,10)}.png`;
	link.href = canvas.toDataURL('image/png');
	link.click();
});

// ==== LANCEMENT INITIAL ====
document.addEventListener('DOMContentLoaded', () => {
	setTimeout(() => {
		document.getElementById('intro').classList.add('hidden');
		renderManualWeather("L'√âtang-Sal√©");
		searchInput.value = "L'√âtang-Sal√©";
	}, 1500);
});
</script>
</body>
</html>
